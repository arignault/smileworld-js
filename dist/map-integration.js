console.log("🗺️ map-integration.js v2.0.0 chargé");const c={map:null,markers:[],infoWindow:null,initialCenter:{lat:48.82,lng:2.25},initialZoom:10,initMap:function(){const e=document.getElementById("map");if(!e){console.error("Erreur : L'élément #map est introuvable dans le DOM.");return}this.map=new google.maps.Map(e,{center:this.initialCenter,zoom:this.initialZoom,disableDefaultUI:!0,zoomControl:!0,styles:[]}),this.infoWindow=new google.maps.InfoWindow,this.createMarkers(),this.listenForFocusEvents()},createMarkers:function(){const e=document.querySelectorAll(".w-dyn-item[data-place-id]");console.log(`📍 ${e.length} cartes trouvées pour la création des marqueurs.`),e.forEach(o=>{var r;const t=parseFloat(o.dataset.lat),a=parseFloat(o.dataset.lng),n=o.dataset.placeId,s=o.getAttribute("id");if(!t||!a||!n){console.warn("⚠️ Carte ignorée car il manque data-lat, data-lng ou data-place-id",o);return}const i=new google.maps.marker.AdvancedMarkerElement({map:this.map,position:{lat:t,lng:a},title:((r=o.querySelector("h3"))==null?void 0:r.textContent)||"Centre Smile World"});i.addListener("click",()=>{const l=o.querySelector('.clickable_wrap[data-attribute="data-card-toggle"]');l?l.click():console.warn("Impossible de trouver l'élément cliquable pour ouvrir la carte",o)}),this.markers.push({placeId:n,cardId:s,marker:i})})},focusOnCenter:function(e){if(!e||!this.map)return;console.log(`🔎 Zoom sur le centre avec Place ID : ${e}`),new google.maps.places.PlacesService(this.map).getDetails({placeId:e,fields:["name","formatted_address","geometry","rating","website","url"]},(t,a)=>{var n;if(a===google.maps.places.PlacesServiceStatus.OK&&t&&t.geometry&&t.geometry.location){this.map.panTo(t.geometry.location),this.map.setZoom(15);const s=`
                    <div class="map-infowindow-content">
                        <div class="map-infowindow-title">${t.name}</div>
                        <div class="map-infowindow-address">${t.formatted_address}</div>
                        ${t.rating?`<div class="map-infowindow-rating">Note : ${t.rating} ★</div>`:""}
                        <a href="${t.url}" target="_blank">Voir sur Google Maps</a>
                    </div>
                `;this.infoWindow.setContent(s);const i=(n=this.markers.find(r=>r.placeId===e))==null?void 0:n.marker;i&&this.infoWindow.open(this.map,i)}else console.error(`Erreur lors de la récupération des détails pour le Place ID ${e}: ${a}`)})},resetMapView:function(){this.map&&(console.log("🔄 Réinitialisation de la vue de la carte."),this.infoWindow.close(),this.map.panTo(this.initialCenter),this.map.setZoom(this.initialZoom))},listenForFocusEvents:function(){document.addEventListener("map:focus",e=>{this.focusOnCenter(e.detail.placeId)})}};window.initGoogleMap=c.initMap.bind(c);
