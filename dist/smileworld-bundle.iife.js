(function(){"use strict";console.log("🚀 loading-screen.js v1.4.0 chargé");const P={logoPopDuration:.3,fadeOutDuration:.4,ease:"power2.out",logoShrinkScale:.8};let q=!1,L=!1,B=!1,R=!1;function O(){B&&R&&X()}function Z(){try{if(sessionStorage.getItem("preloaderShown")){console.log("✅ Preloader déjà affiché dans cette session, on le cache immédiatement.");const t=document.querySelector(".loadingscreen");return t&&(t.style.display="none"),q=!0,L=!0,Promise.resolve()}}catch(t){console.warn("Impossible d'accéder à sessionStorage, le preloader s'affichera à chaque fois.",t)}if(console.log("🎬 initLoadingScreen - Début de l'initialisation (0.9s)"),q)return console.log("ℹ️ Écran de chargement déjà initialisé"),Promise.resolve();const i=document.querySelector(".loadingscreen"),e=document.querySelector(".loading_logo_wrap");return console.log("🔍 Éléments trouvés:",{loadingScreen:!!i,logoWrap:!!e}),!i||!e?(console.warn("⚠️ Éléments manquants:",{loadingScreen:i?"OK":"Non trouvé",logoWrap:e?"OK":"Non trouvé"}),q=!1,Promise.resolve(null)):(console.log("🎨 Configuration des styles initiaux"),window.gsap.set(i,{opacity:1,display:"flex",backgroundColor:"white"}),window.gsap.set(e,{opacity:0,scale:.9}),window.gsap.to(e,{opacity:1,scale:1,duration:.5,delay:.1,ease:P.ease}),setTimeout(()=>{console.log("⏱️ 0.9 secondes écoulées."),R=!0,O()},900),q=!0,console.log("✅ Écran de chargement initialisé avec succès (0.9s)"),Promise.resolve(i))}function K(){console.log("🟢 Application prête, demande de masquage de l'écran de chargement."),B=!0,O()}function X(){if(console.log("🎬 hideLoadingScreen - Début du masquage"),!q){console.warn("⚠️ Écran de chargement non initialisé");return}if(L){console.log("ℹ️ Masquage déjà en cours");return}L=!0;const i=document.querySelector(".loadingscreen"),e=document.querySelector(".loading_logo_wrap");if(console.log("🔍 Éléments trouvés pour le masquage:",{loadingScreen:!!i,logoWrap:!!e}),!i||!e){console.warn("⚠️ Éléments manquants pour le masquage"),L=!1;return}console.log("🎬 Démarrage de l'animation de masquage améliorée"),window.gsap.timeline({onComplete:()=>{console.log("✅ Animation de masquage terminée"),window.gsap.set(i,{display:"none"}),L=!1;try{sessionStorage.setItem("preloaderShown","true")}catch(o){console.warn("Impossible d'enregistrer l'état du preloader dans sessionStorage.",o)}}}).to(e,{opacity:0,scale:P.logoShrinkScale,duration:P.logoPopDuration,ease:P.ease}).to(i,{opacity:0,duration:P.fadeOutDuration,ease:P.ease},"-=0.1")}function z(){const i=document.querySelector(".loadingscreen");i&&window.gsap.to(i,{opacity:0,duration:.5,onComplete:()=>{window.gsap.set(i,{display:"none"})}}),L=!1}console.log("🚀 text-animation.js v2.1.0 chargé");function Y(){const i=document.querySelector(".span_mover");if(i)try{let o=function(){if(t)return;t=!0;const s=gsap.timeline({onComplete:()=>{t=!1,gsap.to(i,{y:e.positions.start,duration:e.duration,ease:e.ease,onComplete:()=>{setTimeout(o,e.cycleDelay*1e3)}})}}),n=[e.positions.start,e.positions.middle,e.positions.end];for(let r=0;r<n.length;r++)s.to(i,{y:n[r],duration:e.duration,ease:e.ease}),r<n.length-1&&s.to({},{duration:e.pauseDuration});s.play()};const e={duration:.6,ease:"back.out(1.7)",pauseDuration:1.5,cycleDelay:.5,positions:{start:"0%",middle:"-34%",end:"-68%"}};let t=!1;o(),window.addEventListener("beforeunload",()=>{gsap.killTweensOf(i)})}catch(e){console.error("Erreur dans l'animation de texte:",e)}}let T=!1;async function H(i){if(!i||!i.classList.contains("is-open"))return;T=!0;const e=i.querySelector(".faq_respond"),t=i.querySelector(".svg-holder");i.classList.remove("is-open");const o=window.gsap.timeline({onComplete:()=>{e&&(e.style.display="none"),T=!1}});t&&o.to(t,{rotation:0,duration:.25,ease:"power2.inOut"},0),e&&(o.to(e,{opacity:0,y:-10,duration:.2,ease:"power1.in"},0),o.to(e,{height:0,duration:.4,ease:"back.in(1.7)"},0)),await o}async function J(i){if(!i||i.classList.contains("is-open"))return;T=!0;const e=i.querySelector(".faq_respond"),t=i.querySelector(".svg-holder");i.classList.add("is-open");const o=window.gsap.timeline({onComplete:()=>{T=!1}});if(e){window.gsap.set(e,{display:"block",opacity:0,y:-20,height:0}),window.getComputedStyle(e).height,window.gsap.set(e,{height:"auto"});const s=e.scrollHeight;window.gsap.set(e,{height:0}),o.to(e,{height:s,duration:.6,ease:"elastic.out(1.2, 0.5)"},0),o.to(e,{opacity:1,y:0,duration:.3,ease:"power2.out"},"<0.05")}t&&o.to(t,{rotation:90,duration:.25,ease:"back.out(1.7)"},0),await o}async function Q(i){if(T)return;if(i.classList.contains("is-open"))await H(i);else{const t=document.querySelectorAll(".faq_item.is-open");await Promise.all(Array.from(t).map(o=>H(o))),await J(i)}}function ee(){const i=document.querySelectorAll(".faq_item");i.length!==0&&i.forEach(e=>{e&&(e.classList.remove("is-open"),e.querySelector(".faq_respond")&&window.gsap.set(e.querySelector(".faq_respond"),{height:0,opacity:0,display:"none"}),e.querySelector(".svg-holder")&&window.gsap.set(e.querySelector(".svg-holder"),{rotation:0}),!e.dataset.faqInitialized&&(e.dataset.faqInitialized="true",e.addEventListener("click",t=>{t.target.closest(".faq_respond a, .faq_respond button")||(t.preventDefault(),Q(e))})))})}console.log('🚀 menu-desktop.js v14.0.0 chargé - Stratégie "Wrapper"');class te{constructor(){this.activePanel=null,this.isAnimating=!1,this.triggerSelector='[data-attribute^="nav-link-desktop-"]',this.wrapperSelector=".desktop_menu_wrapper",this.panelClassMap={parcs:".parc_menu_desktop",activites:".activites_menu_desktop",offres:".offres_menu_desktop"},this._addGlobalListener(),console.log('✅ Gestionnaire de clic "Stratégie Wrapper" est actif.')}_addGlobalListener(){document.body.addEventListener("click",e=>{if(this.isAnimating)return;const t=e.target.closest(this.triggerSelector),o=document.querySelector(this.wrapperSelector);if(this.activePanel&&!t&&!this.activePanel.contains(e.target)){this._closeAll();return}if(!t)return;if(e.preventDefault(),e.stopPropagation(),!o){console.error(`Wrapper introuvable avec le sélecteur: ${this.wrapperSelector}`);return}const s=t.getAttribute("data-attribute").replace("nav-link-desktop-",""),n=o.querySelector(this.panelClassMap[s]);if(!n){console.error(`Panneau cible pour la clé "${s}" non trouvé dans le wrapper.`);return}const r=this.activePanel===n,a=!this.activePanel;r?this._closeAll():a?this._openWrapperAndPanel(n):this._switchPanels(this.activePanel,n)})}_openWrapperAndPanel(e){const t=document.querySelector(this.wrapperSelector);this.isAnimating=!0,window.gsap.set(t,{display:"flex",opacity:0}),Object.values(this.panelClassMap).forEach(o=>{const s=t.querySelector(o);s&&window.gsap.set(s,{display:"none"})}),window.gsap.set(e,{display:"flex"}),window.gsap.to(t,{opacity:1,duration:.3,ease:"power2.out",onComplete:()=>{this.isAnimating=!1,this.activePanel=e}})}_closeAll(){const e=document.querySelector(this.wrapperSelector);!this.activePanel||!e||(this.isAnimating=!0,window.gsap.to(e,{opacity:0,duration:.2,ease:"power1.in",onComplete:()=>{window.gsap.set(e,{display:"none"}),this.activePanel&&window.gsap.set(this.activePanel,{display:"none"}),this.activePanel=null,this.isAnimating=!1}}))}_switchPanels(e,t){this.isAnimating=!0;const o=window.gsap.timeline({onComplete:()=>{this.isAnimating=!1,this.activePanel=t}});o.to(e,{opacity:0,duration:.15,onComplete:()=>window.gsap.set(e,{display:"none"})}),o.set(t,{display:"flex",opacity:0}),o.to(t,{opacity:1,duration:.15})}}function ie(){new te}function oe(){const i=document.querySelector("#hamburger-menu"),e=document.querySelector("#main-menu-mobile"),t=document.body,o=document.querySelector("#parcs-nav_button_mobile"),s=document.querySelector("#activites-nav_button_mobile"),n=document.querySelector("#formules-nav_button_mobile"),r=document.querySelector("#parc-menu-mobile"),a=document.querySelector("#activite-menu-mobile"),l=document.querySelector("#offres-menu-mobile"),c=document.querySelectorAll(".button-close"),m=document.querySelectorAll(".button-back-menu");let u=!1,S=0,b=window.gsap.timeline({paused:!0});const y=window.gsap.timeline({paused:!0});y.to(i,{rotation:90,duration:.4,ease:"elastic.out(1, 0.5)",transformOrigin:"center center"}),[e,r,a,l].forEach(d=>{d.style.display="none"});function _(){S=window.pageYOffset||document.documentElement.scrollTop,t.style.overflow="hidden",t.style.position="fixed",t.style.width="100%",t.style.top=`-${S}px`}function k(){t.style.overflow="",t.style.position="",t.style.width="",t.style.top="",window.scrollTo(0,S)}function x(){return window.gsap.timeline({paused:!0}).add(()=>{e.style.display="flex",[r,a,l].forEach(d=>{d.style.display="none"})},"openMainMenu").add(()=>{e.style.display="none",r.style.display="flex"},"openParcMenu").add(()=>{e.style.display="none",a.style.display="flex"},"openActiviteMenu").add(()=>{e.style.display="none",l.style.display="flex"},"openOffresMenu")}b=x();function g(d=null){[o,s,n,document.querySelector("#parcs-nav_button"),document.querySelector("#activites-nav_button"),document.querySelector("#formules-nav_button")].forEach(v=>{v&&(d&&v.id===d?v.classList.add("active"):v.classList.remove("active"))})}function A(d){d?y.play():y.reverse()}function p(d){const v={"parcs-nav_button":r,"activites-nav_button":a,"formules-nav_button":l,"parcs-nav_button_mobile":r,"activites-nav_button_mobile":a,"formules-nav_button_mobile":l}[d];if(v){if(e.style.display="none",r.style.display="none",a.style.display="none",l.style.display="none",u&&v.style.display==="flex"){u=!1,k(),g(),A(!1);return}requestAnimationFrame(()=>{v.style.display="flex",u=!0,_(),g(d),A(!0)})}}function f(){b&&b.kill(),u=!1,[e,r,a,l].forEach(d=>{d.style.display="none"}),k(),g(),A(!1),b=x()}function E(){[r,a,l].forEach(d=>{d.style.display="none"}),e.style.display="flex",u=!0}function w(d){e.style.display="none",u=!0,d.style.display="flex"}i.addEventListener("click",()=>{u?f():([r,a,l].forEach(d=>{d.style.display="none"}),e.style.display="flex",u=!0,_(),A(!0))}),o.addEventListener("click",()=>w(r)),s.addEventListener("click",()=>w(a)),n.addEventListener("click",()=>w(l)),c.forEach(d=>{d.addEventListener("click",f)}),m.forEach(d=>{d.addEventListener("click",E)}),document.querySelectorAll("#parcs-nav_button, #activites-nav_button, #formules-nav_button, #parcs-nav_button_mobile, #activites-nav_button_mobile, #formules-nav_button_mobile").forEach(d=>{d.addEventListener("click",I=>{I.preventDefault(),p(d.id)})})}console.log("🚀 centre-card.js v6.1.0 chargé");const h={CARD:".centre-card_wrapper.effect-cartoon-shadow",CLICKABLE_WRAP:'.clickable_wrap[data-attribute="data-card-toggle"]',TOGGLE_ELEMENTS:[".centre-card_scroll_wrapper",".centre-card_list",".centre-card_button-holder",".tag_holder_wrapper"],ARROW:".svg-holder.arrow",INTERNAL_LINKS:".centre-card_button-holder a, .centre-card_button-holder button"},j=new WeakSet;let D=!1;async function W(i){if(!i||!i.classList.contains("is-open"))return;const e=i.querySelectorAll(h.TOGGLE_ELEMENTS.join(",")),t=i.querySelector(h.ARROW),o=i.querySelector(".centre-card_scroll_wrapper");i.classList.remove("is-open");const s=window.gsap.timeline({onStart:()=>{o&&window.gsap.set(o,{height:"10rem"})},onComplete:()=>{window.gsap.set(e,{display:"none"}),o&&window.gsap.set(o,{height:0})}});s.to(e,{opacity:0,y:-10,duration:.2,ease:"power1.in",stagger:{each:.02,from:"start"}},0),t&&s.to(t,{rotation:0,duration:.25,ease:"power2.inOut"},0),o&&s.to(o,{height:0,duration:.4,ease:"back.in(1.7)"},0),await s}async function N(i){if(!i||i.classList.contains("is-open"))return;i.classList.add("is-open");const e=i.querySelectorAll(h.TOGGLE_ELEMENTS.join(",")),t=i.querySelector(h.ARROW),o=i.querySelector(".centre-card_scroll_wrapper");e.forEach(n=>{window.gsap.set(n,{display:n.dataset.originalDisplay||"block",opacity:0,y:-20})});const s=window.gsap.timeline({onStart:()=>{o&&window.gsap.set(o,{height:0})}});o&&s.to(o,{height:"10rem",duration:.6,ease:"elastic.out(1.2, 0.5)"},0),t&&s.to(t,{rotation:90,duration:.25,ease:"back.out(1.7)"},"<"),s.to(e,{opacity:1,y:0,duration:.3,ease:"power2.out",stagger:{each:.035,from:"start"}},"<0.05"),await s}async function se(i){var e;if(!D){D=!0;try{if(i.classList.contains("is-open"))await W(i),document.dispatchEvent(new CustomEvent("map:reset")),console.log("🗺️ Événement map:reset émis");else{const o=document.querySelectorAll(`${h.CARD}.is-open`);await Promise.all(Array.from(o).map(n=>W(n))),await N(i);const s=(e=i.closest(".w-dyn-item"))==null?void 0:e.dataset.placeId;s&&(document.dispatchEvent(new CustomEvent("map:focus",{detail:{placeId:s}})),console.log("📍 Événement map:focus émis pour:",s))}}finally{D=!1}}}function F(i){var s,n;if(!i||j.has(i)){console.log("⏭️ Carte déjà initialisée, ignorée");return}console.log("🔧 Initialisation de la carte:",i);let e=(s=i.parentElement)==null?void 0:s.querySelector(h.CLICKABLE_WRAP);if(e||(e=(n=i.parentElement)==null?void 0:n.querySelector(".clickable_wrap"),e&&console.log("✅ Clickable wrap trouvé sans attribut data-card-toggle")),!e){console.log("❌ Clickable wrap non trouvé pour la carte:",i);return}const t=i.querySelectorAll(h.TOGGLE_ELEMENTS.join(","));console.log(`📋 Éléments à basculer trouvés: ${t.length}`),t.forEach(r=>{const a=window.getComputedStyle(r);r.dataset.originalDisplay=a.display,console.log(`💾 Display original sauvé pour ${r.className}: ${a.display}`)}),window.gsap.set(t,{display:"none",opacity:0,y:-20}),console.log("🔒 Carte fermée par défaut");const o=r=>{if(r.target.closest(h.INTERNAL_LINKS)){console.log("🔗 Clic sur lien interne, toggle ignoré");return}r.preventDefault(),r.stopPropagation(),console.log("👆 Clic sur carte détecté"),se(i)};e.addEventListener("click",o),j.add(i),console.log("✅ Carte initialisée avec succès")}function ne(){const i=document.querySelector(".collection-list-centre-wrapper");if(!i)return;new MutationObserver(t=>{for(const o of t)o.type==="childList"&&o.addedNodes.forEach(s=>{s.nodeType===1&&(s.matches(h.CARD)&&F(s),s.querySelectorAll(h.CARD).forEach(n=>F(n)))})}).observe(i,{childList:!0,subtree:!0})}function ae(i){if(!i)return null;const e=document.querySelectorAll(".w-dyn-item");for(const t of e){const o=t.querySelector(h.CARD);if(!o)continue;if(t.querySelectorAll('a[href*="/nos-parcs-a-paris-region-parisienne/'+i+'"]').length>0)return o}return null}function re(){console.log("🎯 Configuration de l'écoute du menu Parcs..."),document.addEventListener("click",i=>{const e=i.target.closest('a[href*="/nos-parcs-a-paris-region-parisienne/"]');if(!e||!window.location.pathname.includes("/activites-par-centre/"))return;const o=e.getAttribute("href").split("/nos-parcs-a-paris-region-parisienne/")[1];console.log("🖱️ Clic détecté sur lien centre:",o),setTimeout(()=>{const s=ae(o);s?(console.log("✅ Carte trouvée pour le centre cliqué, ouverture..."),document.querySelectorAll(`${h.CARD}.is-open`).forEach(r=>{r!==s&&W(r)}),s.classList.contains("is-open")||N(s)):console.log("❌ Aucune carte trouvée pour le centre:",o)},300)}),console.log("✅ Écoute du menu Parcs configurée")}function le(){if(console.log("🚀 === INITIALISATION DES CARTES DE CENTRE ==="),console.log("📍 Page actuelle:",window.location.pathname),console.log("🏗️ DOM ready state:",document.readyState),!window.gsap){console.log("❌ GSAP non disponible, initialisation annulée");return}let i=document.querySelectorAll(h.CARD);if(i.length===0){console.log("⚠️ Aucune carte trouvée avec le sélecteur principal. Tentative avec sélecteurs alternatifs...");const e=[".centre-card_wrapper",'[class*="centre-card"]',".card-centre_wrapper"];for(const t of e)if(i=document.querySelectorAll(t),i.length>0){console.log(`✅ Cartes trouvées avec sélecteur alternatif: ${t} (${i.length} éléments)`);break}}if(console.log(`📊 ${i.length} cartes trouvées au total`),i.length===0){console.log("❌ Aucune carte trouvée, initialisation annulée");return}i.forEach(e=>{e.classList.contains("is-open")&&(console.log("🔒 Fermeture forcée de carte ouverte au démarrage"),e.classList.remove("is-open"))}),i.forEach((e,t)=>{console.log(`🔧 Initialisation carte ${t+1}/${i.length}`),F(e)}),ne(),re(),console.log("✅ === INITIALISATION TERMINÉE ===")}function ce(){console.group("--- Informations de Débogage ---"),console.log("Wrapper Menu Desktop:",document.querySelector(".desktop_menu_wrapper")),console.log("Boutons de menu:",{parcs:document.querySelector('[data-attribute="nav-link-desktop-parcs"]'),activites:document.querySelector('[data-attribute="nav-link-desktop-activites"]'),offres:document.querySelector('[data-attribute="nav-link-desktop-offres"]')}),console.log("Conteneurs de menu:",{parcs:document.querySelector(".parc_menu_desktop"),activites:document.querySelector(".activites_menu_desktop"),offres:document.querySelector(".offres_menu_desktop")}),console.groupEnd()}function de(){window.location.hash==="#debug"&&(console.log("🐛 Mode de débogage activé."),ce())}class ue{constructor(){this.config={defaultVideoUrl:"https://player.vimeo.com/progressive_redirect/playback/1088767237/rendition/1080p/file.mp4?loc=external&signature=1d46b415bde9b315b01d645374b5f7319940ecff5995ac8ac213f847577f6536",ids:{initialContainer:"container-initial",filteredContainer:"container-filtre",hiddenMap:"hidden-map",initialActivitiesPane:"tab-pane-initial-activites",initialParksPane:"tab-pane-initial-parcs",filteredActivitiesPane:"tab-pane-filtre-activites",filteredParksPane:"tab-pane-filtre-parcs",initialActivitiesTabLink:"tab-link-initial-activites",initialParksTabLink:"tab-link-initial-parcs",filteredActivitiesTabLink:"tab-link-filtre-activites",filteredParksTabLink:"tab-link-filtre-parcs",selectionWrapper:"selection-wrapper",label:"selection-label",reserveBtn:"reserve-btn",iframeWrap:"iframe-wrapper"}},this.state={primarySelectionType:null,selectedInitialSlugs:new Set,selectedInitialParkId:null,finalSelectedParkId:null,finalSelectedSlugs:new Set},this.dom={},this.mapItems=[],this.init()}init(){this._setupDomElements()&&(this._injectStyles(),this._injectVideoPlayer(),this._setupEventListeners(),this._applyUrlParameters(),this._setInitialUiState())}_setupDomElements(){for(const e in this.config.ids)if(this.dom[e]=document.getElementById(this.config.ids[e]),!this.dom[e])return console.error(`[SW-RSV] Essential element #${this.config.ids[e]} is missing.`),!1;return this.dom.videoBackgroundDiv=document.querySelector('[data-attribute="video_background"]'),this.dom.resetButton=document.querySelector('[data-attribute="reset_form"]'),this.mapItems=Array.from(this.dom.hiddenMap.querySelectorAll(".map-item")),!0}_setInitialUiState(){this.dom.filteredContainer.style.display="none",this.dom.reserveBtn.classList.add("disabled"),this.dom.iframeWrap.style.display="none",this.dom.selectionWrapper&&(window.gsap.set(this.dom.selectionWrapper,{opacity:.5,pointerEvents:"none"}),window.gsap.set(this.dom.label,{opacity:0}))}_setupEventListeners(){this.dom.initialActivitiesPane.addEventListener("click",this._handleSelection.bind(this,"initialActivity")),this.dom.initialParksPane.addEventListener("click",this._handleSelection.bind(this,"initialPark")),this.dom.filteredActivitiesPane.addEventListener("click",this._handleSelection.bind(this,"finalActivity")),this.dom.filteredParksPane.addEventListener("click",this._handleSelection.bind(this,"finalPark")),this.dom.reserveBtn.addEventListener("click",this._handleReserveClick.bind(this)),this.dom.resetButton&&this.dom.resetButton.addEventListener("click",this._fullReset.bind(this))}_handleSelection(e,t){const o=t.target.closest("[data-activity-slug], [data-centre-apex-id]");if(!o)return;const s=o.dataset.activitySlug,n=o.dataset.centreApexId;switch(e){case"initialActivity":this._handleInitialActivitySelection(s,o);break;case"initialPark":this._handleInitialParkSelection(n,o);break;case"finalActivity":this._handleFinalActivitySelection(s,o);break;case"finalPark":this._handleFinalParkSelection(n,o);break}}_handleInitialActivitySelection(e,t){if(this.state.primarySelectionType==="parks"&&(this._resetInitialSelections("parks"),this._resetInitialTabs()),this.state.primarySelectionType="activities",t.classList.toggle("isSelected"),t.classList.contains("isSelected")?this.state.selectedInitialSlugs.add(e):this.state.selectedInitialSlugs.delete(e),this._resetFinalSelections(),this.state.selectedInitialSlugs.size>0){this.dom.initialParksTabLink.style.display="none";const o=Array.from(this.state.selectedInitialSlugs).map(r=>new Set(this.mapItems.filter(a=>a.dataset.activitySlug===r).map(a=>a.dataset.centreApexId))),s=o.length>0?o[0]:new Set,n=o.reduce((r,a)=>new Set([...r].filter(l=>a.has(l))),s);this.dom.filteredParksPane.querySelectorAll("[data-centre-apex-id]").forEach(r=>{r.style.display=n.has(r.dataset.centreApexId)?"block":"none"}),this.dom.filteredContainer.style.display="flex",this._switchFilteredTab("parks")}else this._resetInitialTabs(),this.dom.filteredContainer.style.display="none",this._resetFilteredTabs(),this.state.primarySelectionType=null;this._updateStateAndButton()}_handleInitialParkSelection(e,t){this.state.primarySelectionType==="activities"&&(this._resetInitialSelections("activities"),this._resetInitialTabs()),this.state.primarySelectionType="parks";const o=this.state.selectedInitialParkId===e;if(this._resetFinalSelections(),o)this.state.selectedInitialParkId=null,t.classList.remove("isSelected"),this._resetInitialTabs(),this.dom.filteredContainer.style.display="none",this._resetFilteredTabs(),this._updateVideoSource(null);else{this.dom.initialParksPane.querySelectorAll("[data-centre-apex-id]").forEach(n=>n.classList.remove("isSelected")),this.state.selectedInitialParkId=e,t.classList.add("isSelected"),this._updateVideoSource(t),this.dom.initialActivitiesTabLink.style.display="none";const s=new Set(this.mapItems.filter(n=>n.dataset.centreApexId===e).map(n=>n.dataset.activitySlug));this.dom.filteredActivitiesPane.querySelectorAll("[data-activity-slug]").forEach(n=>{n.style.display=s.has(n.dataset.activitySlug)?"block":"none"}),this.dom.filteredContainer.style.display="flex",this._switchFilteredTab("activities")}this._updateStateAndButton()}_handleFinalParkSelection(e,t){this.state.primarySelectionType==="activities"&&(this.state.finalSelectedParkId===e?(this.state.finalSelectedParkId=null,t.classList.remove("isSelected"),this._updateVideoSource(null)):(this.dom.filteredParksPane.querySelectorAll("[data-centre-apex-id]").forEach(o=>o.classList.remove("isSelected")),this.state.finalSelectedParkId=e,t.classList.add("isSelected"),this._updateVideoSource(t)),this._updateStateAndButton())}_handleFinalActivitySelection(e,t){this.state.primarySelectionType==="parks"&&(t.classList.toggle("isSelected"),t.classList.contains("isSelected")?this.state.finalSelectedSlugs.add(e):this.state.finalSelectedSlugs.delete(e),this._updateStateAndButton())}_handleReserveClick(e){if(this.dom.reserveBtn.classList.contains("disabled")){e.preventDefault();return}e.preventDefault();const t=this.dom.reserveBtn.href;if(t&&t!=="#"){this.dom.iframeWrap.innerHTML=`<iframe src="${t}" style="width: 100%; height: 100vh; border: none;"></iframe>`,this.dom.iframeWrap.style.display="block";const o=this.dom.iframeWrap.getBoundingClientRect().top+window.scrollY,n=7*parseFloat(getComputedStyle(document.documentElement).fontSize);window.scrollTo({top:o-n,behavior:"smooth"})}}_updateStateAndButton(){let e=null,t=null;if(this.state.primarySelectionType==="activities"?(e=this.state.finalSelectedParkId,t=this.state.selectedInitialSlugs):this.state.primarySelectionType==="parks"&&(e=this.state.selectedInitialParkId,t=this.state.finalSelectedSlugs),e&&t&&t.size>0){const o=Array.from(t).map(s=>{const n=this.mapItems.find(r=>r.dataset.centreApexId===e&&r.dataset.activitySlug===s);return n?n.dataset.activityApexId:null}).filter(Boolean);if(o.length===t.size){const s=o.join(",");this.dom.reserveBtn.href=`https://www.apex-timing.com/gokarts/sessions_booking.php?center=${e}&categories=${s}&language=fr&iframe_id=axiframe_0`,this.dom.reserveBtn.classList.remove("disabled");const n=this.state.primarySelectionType==="activities"?this.dom.filteredParksPane.querySelector(`[data-centre-apex-id="${e}"]`):this.dom.initialParksPane.querySelector(`[data-centre-apex-id="${e}"]`),r=n?n.dataset.parkLabel:"",a=Array.from(t).map(l=>{const c=this.state.primarySelectionType==="activities"?this.dom.initialActivitiesPane.querySelector(`[data-activity-slug="${l}"]`):this.dom.filteredActivitiesPane.querySelector(`[data-activity-slug="${l}"]`);return c?c.dataset.activityLabel:l});this.dom.label.textContent=`C'est parti pour ${a.map(l=>`un ${l}`).join(" & ")} à ${r} !`,this._animateSelectionAppearance()}else this.dom.reserveBtn.href="#",this.dom.reserveBtn.classList.add("disabled"),this.dom.label.textContent="La combinaison sélectionnée est invalide.",this._resetSelectionAppearance()}else this.dom.reserveBtn.href="#",this.dom.reserveBtn.classList.add("disabled"),this.dom.label.textContent="Veuillez terminer votre sélection.",this._resetSelectionAppearance()}_switchFilteredTab(e){const t="w--current",o=e==="parks"?"Parks":"Activities",s=e==="parks"?"Activities":"Parks";this.dom[`filtered${o}TabLink`].classList.add(t),this.dom[`filtered${s}TabLink`].classList.remove(t),this.dom[`filtered${o}Pane`].classList.add(t),this.dom[`filtered${s}Pane`].classList.remove(t),this.dom[`filtered${o}TabLink`].style.display="inline-block",this.dom[`filtered${o}Pane`].style.display="block",this.dom[`filtered${s}TabLink`].style.display="none",this.dom[`filtered${s}Pane`].style.display="none"}_animateSelectionAppearance(){if(!this.dom.selectionWrapper)return;window.gsap.timeline().to(this.dom.selectionWrapper,{opacity:1,pointerEvents:"auto",duration:.4,ease:"power2.inOut"}).from(this.dom.selectionWrapper,{scale:.9,ease:"elastic.out(1, 0.6)",duration:1.2},"-=0.2").to(this.dom.label,{opacity:1,duration:.5},"-=1")}_resetSelectionAppearance(){this.dom.selectionWrapper&&(window.gsap.to(this.dom.selectionWrapper,{opacity:.5,pointerEvents:"none",duration:.3}),window.gsap.to(this.dom.label,{opacity:0,duration:.2}))}_updateVideoSource(e){if(!this.dom.videoBackgroundDiv)return;const t=this.dom.videoBackgroundDiv.querySelector("source"),o=this.dom.videoBackgroundDiv.querySelector("video");if(!t||!o)return;const s=e&&e.dataset.video?e.dataset.video:this.config.defaultVideoUrl;t.src!==s&&(t.src=s,o.load(),o.play().catch(()=>{}))}_fullReset(e){e&&e.preventDefault(),this.state.primarySelectionType=null,this._resetInitialSelections("activities"),this._resetInitialSelections("parks"),this._resetFinalSelections(),this._resetInitialTabs(),this._resetFilteredTabs(),this.dom.filteredContainer.style.display="none",this.dom.iframeWrap.style.display="none",this._updateStateAndButton()}_resetInitialTabs(){this.dom.initialActivitiesTabLink&&(this.dom.initialActivitiesTabLink.style.display="flex"),this.dom.initialParksTabLink&&(this.dom.initialParksTabLink.style.display="flex")}_resetInitialSelections(e){e==="activities"?(this.dom.initialActivitiesPane.querySelectorAll("[data-activity-slug]").forEach(t=>t.classList.remove("isSelected")),this.state.selectedInitialSlugs.clear()):e==="parks"&&(this.dom.initialParksPane.querySelectorAll("[data-centre-apex-id]").forEach(t=>t.classList.remove("isSelected")),this.state.selectedInitialParkId=null,this._updateVideoSource(null))}_resetFinalSelections(){this.dom.filteredActivitiesPane.querySelectorAll("[data-activity-slug]").forEach(e=>e.classList.remove("isSelected")),this.state.finalSelectedSlugs.clear(),this.dom.filteredParksPane.querySelectorAll("[data-centre-apex-id]").forEach(e=>e.classList.remove("isSelected")),this.state.finalSelectedParkId=null}_resetFilteredTabs(){this.dom.filteredActivitiesTabLink.style.display="inline-block",this.dom.filteredParksTabLink.style.display="inline-block"}_injectStyles(){const e=document.createElement("style");e.id="sw-rsv-styles",e.textContent=`
        .isSelected .tags_content { background-color: black !important; color: white !important; }
        .isSelected .tags_content * { color: white !important; }`,document.head.appendChild(e)}_injectVideoPlayer(){this.dom.videoBackgroundDiv.innerHTML=`<video playsinline autoplay muted loop class="background-video_element" style="width: 100%; height: 100%; object-fit: cover;"><source src="${this.config.defaultVideoUrl}" type="video/mp4"></video>`}_applyUrlParameters(){const e=new URLSearchParams(window.location.search),t=e.get("activite"),o=e.get("parc");!t&&!o||(o&&t?(this.dom.initialParksTabLink&&this.dom.initialParksTabLink.click(),setTimeout(()=>{const s=this.dom.initialParksPane.querySelector(`[data-centre-apex-id="${o}"]`);s&&s.click(),setTimeout(()=>{const n=this.dom.filteredActivitiesPane.querySelector(`[data-activity-slug="${t}"]`);n&&(n.click(),setTimeout(()=>{this.dom.reserveBtn.classList.contains("disabled")||(console.log("🎯 Auto-clic sur le bouton Réserver avec les deux paramètres présélectionnés"),this.dom.reserveBtn.click())},200))},100)},100)):t?(this.dom.initialActivitiesTabLink&&this.dom.initialActivitiesTabLink.click(),setTimeout(()=>{const s=this.dom.initialActivitiesPane.querySelector(`[data-activity-slug="${t}"]`);s&&s.click()},100)):o&&(this.dom.initialParksTabLink&&this.dom.initialParksTabLink.click(),setTimeout(()=>{const s=this.dom.initialParksPane.querySelector(`[data-centre-apex-id="${o}"]`);s&&s.click()},100)))}}function pe(){new ue}console.log("🗺️ map-integration.js v2.1.1 chargé");const M={map:null,markers:[],infoWindow:null,bottomSheetElement:null,initialCenter:{lat:48.82,lng:2.25},initialZoom:10,initMap:function(){const i=document.getElementById("map");if(!i){console.error("Erreur : L'élément #map est introuvable dans le DOM.");return}const e=i.dataset.mapId;e||console.warn("⚠️ data-map-id n'est pas défini sur l'élément #map. Les marqueurs avancés pourraient ne pas fonctionner."),this.map=new google.maps.Map(i,{center:this.initialCenter,zoom:this.initialZoom,disableDefaultUI:!0,zoomControl:!0,mapId:e}),this.infoWindow=new google.maps.InfoWindow,google.maps.event.addListener(this.infoWindow,"closeclick",()=>{this.resetMapView()}),this.injectBottomSheet(),this.createMarkers()},injectBottomSheet:function(){const i=document.createElement("style");i.textContent=`
            .map-bottom-sheet {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background-color: white;
                border-top-left-radius: 16px;
                border-top-right-radius: 16px;
                box-shadow: 0 -4px 12px rgba(0,0,0,0.1);
                transform: translateY(100%);
                transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
                z-index: 1000;
                max-height: 85vh;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
                visibility: hidden;
            }
            .map-bottom-sheet.is-visible {
                transform: translateY(0);
                visibility: visible;
            }
            .map-bottom-sheet__content {
                padding: 24px;
                padding-top: 50px;
            }
            .map-bottom-sheet__close-btn {
                position: absolute;
                top: 12px;
                right: 12px;
                background: #f0f0f0;
                border: none;
                border-radius: 50%;
                width: 32px;
                height: 32px;
                font-size: 22px;
                line-height: 32px;
                text-align: center;
                cursor: pointer;
                font-weight: bold;
                color: #333;
                z-index: 2;
            }
            .map-bottom-sheet__handle {
                position: absolute;
                top: 8px;
                left: 50%;
                transform: translateX(-50%);
                width: 40px;
                height: 4px;
                background-color: #ccc;
                border-radius: 2px;
            }
        `,document.head.appendChild(i),document.body.insertAdjacentHTML("beforeend",`
            <div id="map-bottom-sheet" class="map-bottom-sheet" aria-hidden="true">
                <div class="map-bottom-sheet__handle"></div>
                <button class="map-bottom-sheet__close-btn" aria-label="Fermer">&times;</button>
                <div class="map-bottom-sheet__content"></div>
            </div>
        `),this.bottomSheetElement=document.getElementById("map-bottom-sheet"),this.bottomSheetElement.querySelector(".map-bottom-sheet__close-btn").addEventListener("click",()=>{this.hideBottomSheet()})},createMarkers:function(){const i=document.querySelectorAll(".w-dyn-item[data-place-id]");console.log(`📍 ${i.length} cartes trouvées pour la création des marqueurs.`),i.forEach(e=>{var r,a;const t=parseFloat(e.dataset.lat),o=parseFloat(e.dataset.lng),s=e.dataset.placeId;if(isNaN(t)||isNaN(o)||!s){const l=((r=e.querySelector("h3"))==null?void 0:r.textContent)||"Nom non trouvé";console.warn(`⚠️ Carte ignorée (nom: "${l}") car ses données de latitude/longitude sont manquantes ou invalides.`,e);return}const n=new google.maps.marker.AdvancedMarkerElement({map:this.map,position:{lat:t,lng:o},title:((a=e.querySelector("h3"))==null?void 0:a.textContent)||"Centre Smile World"});n.addListener("click",()=>{window.matchMedia("(max-width: 768px)").matches?this.showBottomSheetForPlace(s):this.focusOnCenter(s,n)}),this.markers.push({placeId:s,marker:n})})},focusOnCenter:async function(i,e){var t;if(!(!i||!this.map)){console.log(`🔎 Zoom sur le centre avec Place ID : ${i}`);try{const{Place:o}=await google.maps.importLibrary("places"),s=new o({id:i}),n=["displayName","formattedAddress","location","rating","googleMapsURI","photos","reviews","userRatingCount","regularOpeningHours"];if(await s.fetchFields({fields:n}),s.location){this.map.panTo(s.location),this.map.setZoom(15);const r=this.buildInfoWindowContent(s,!1);this.infoWindow.setContent(r);const a=e||((t=this.markers.find(l=>l.placeId===i))==null?void 0:t.marker);a&&this.infoWindow.open(this.map,a)}else console.error(`Aucune donnée de localisation trouvée pour le Place ID ${i}`)}catch(o){console.error(`Erreur lors de la récupération des détails pour le Place ID ${i}:`,o)}}},showBottomSheetForPlace:async function(i){if(!(!i||!this.map)){console.log(`📱 Affichage du panneau mobile pour Place ID : ${i}`);try{const{Place:e}=await google.maps.importLibrary("places"),t=new e({id:i}),o=["displayName","formattedAddress","location","rating","googleMapsURI","photos","reviews","userRatingCount","regularOpeningHours"];if(await t.fetchFields({fields:o}),t.location){this.map.panTo(t.location),this.map.setZoom(15);const s=this.buildInfoWindowContent(t,!0);this.bottomSheetElement.querySelector(".map-bottom-sheet__content").innerHTML=s,this.bottomSheetElement.classList.add("is-visible"),this.bottomSheetElement.setAttribute("aria-hidden","false")}else console.error(`Aucune donnée de localisation trouvée pour le Place ID ${i}`)}catch(e){console.error(`Erreur lors de la récupération des détails pour le Place ID ${i}:`,e)}}},hideBottomSheet:function(){!this.bottomSheetElement||!this.map||(this.bottomSheetElement.classList.remove("is-visible"),this.bottomSheetElement.setAttribute("aria-hidden","true"),console.log("🔙 Réinitialisation de la vue de la carte..."),this.map.panTo(this.initialCenter),this.map.setZoom(this.initialZoom))},buildInfoWindowContent:function(i,e=!1){let t="";i.photos&&i.photos.length>0&&(t=`<img src="${i.photos[0].getURI({maxWidth:400,maxHeight:200})}" alt="Photo de ${i.displayName}" style="width: 100%; height: 120px; object-fit: cover; border-radius: 8px; margin-bottom: 12px;">`);let o="";i.rating&&(o=`
                <div style="display: flex; align-items: center; color: #555; margin-bottom: 8px; font-size: 14px;">
                    <span style="color: #f8b400; font-size: 18px; margin-right: 8px;">${"★".repeat(Math.round(i.rating))+"☆".repeat(5-Math.round(i.rating))}</span>
                    <span style="font-weight: bold; color: #111; margin-right: 5px;">${i.rating.toFixed(1)}</span>
                    <span>(${i.userRatingCount||0} avis)</span>
                </div>`);let s="";if(i.reviews&&i.reviews.length>0){const a=i.reviews[0];a.text&&(s=`
                    <div style="margin-top: 16px;">
                        <strong style="display: block; font-size: 14px; color: #111; margin-bottom: 8px; font-weight: 600;">Dernier avis</strong>
                        <div style="border-left: 3px solid #f0f0f0; padding-left: 12px; font-style: italic;">
                            <p style="margin: 0 0 5px 0; font-size: 13px; color: #555;">"${a.text.substring(0,100)}..."</p>
                            <span style="font-weight: 500; font-size: 12px; color: #333;">- ${a.authorAttribution.displayName}</span>
                        </div>
                    </div>
                `)}let n="";if(i.regularOpeningHours&&i.regularOpeningHours.weekdayDescriptions){const a=new Date().getDay(),l=a===0?6:a-1;n=`<div style="font-size: 13px; color: #333; margin-bottom: 12px; display: flex; align-items: center;"><svg viewBox="0 0 24 24" style="width:16px; height:16px; margin-right: 8px; fill: #555;"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path d="M13 7h-2v6h6v-2h-4V7z"></path></svg><span>${i.regularOpeningHours.weekdayDescriptions[l]}</span></div>`}return`
            <div style="${`font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; ${e?"":"max-width: 290px;"} padding: 5px;`}">
                ${t}
                <div style="font-size: 18px; font-weight: 700; color: #1a1a1a; margin-bottom: 4px;">${i.displayName}</div>
                <div style="font-size: 13px; color: #555; margin-bottom: 8px;">${i.formattedAddress}</div>
                ${o}
                ${n}
                <a href="${i.googleMapsURI}" target="_blank" style="display: inline-block; margin-top: 8px; font-size: 13px; color: #1a73e8; text-decoration: none; font-weight: 500;">Voir sur Google Maps</a>
                ${s}
            </div>
        `},resetMapView:function(){this.map&&(console.log("🔄 Réinitialisation de la vue de la carte."),this.infoWindow.close(),this.hideBottomSheet(),this.map.panTo(this.initialCenter),this.map.setZoom(this.initialZoom))}};window.initGoogleMap=M.initMap.bind(M),window.mapManager=M;function me(){const i=document.getElementById("map");if(!i)return;const e=i.dataset.apiKey;if(!e){console.error(`❌ Clé API Google Maps manquante. Veuillez l'ajouter dans l'attribut "data-api-key" de la div #map.`);return}if(window.google&&window.google.maps){console.log("🗺️ Google Maps API déjà chargée."),M.initMap();return}console.log("🗺️ Chargement de l'API Google Maps...");const t=document.createElement("script");t.src=`https://maps.googleapis.com/maps/api/js?key=${e}&libraries=places,marker&callback=initGoogleMap&loading=async&language=fr`,t.async=!0,document.head.appendChild(t)}console.log("🔗 preselect.js prêt à être initialisé");function fe(){const i="[SW-PRESELECT]",e=(...l)=>console.log(new Date().toLocaleTimeString(),i,...l),t="/reservation",o=document.querySelector("[data-preselect-activity-slug], [data-preselect-park-id]");if(!o){console.warn(i,"Aucun élément wrapper avec [data-preselect-activity-slug] ou [data-preselect-park-id] trouvé.");return}const s=document.querySelectorAll('[data-attribute="preselect-booking-button"]');console.log("✅ Module de présélection initialisé.");const n=o.dataset.preselectActivitySlug,r=o.dataset.preselectParkId,a=new URLSearchParams;if(n&&a.set("activite",n),r&&a.set("parc",r),a.toString()){const l=`${t}?${a.toString()}`;s.forEach(c=>{c.href=l,c.addEventListener("click",function(m){m.preventDefault(),m.stopPropagation(),window.location.href=l},!0)}),e(`Liens de réservation mis à jour et clics gérés pour pointer vers : ${l}`)}}const ge=()=>{const i=document.querySelector(".desktop_menu_content.right .w-dyn-items"),e=document.querySelectorAll(".desktop_menu_list.acitivt-s .default-container");if(!i||!e.length)return;const t=Array.from(i.children).find(a=>{const l=a.querySelector("img");return l&&l.id==="Bowling"});Array.from(i.children).forEach(a=>{a===t?(a.style.opacity="1",a.style.display="block"):(a.style.opacity="0",a.style.display="none")});const o=new Map;let s=null;const n=(a,l)=>{const c=Array.from(i.children).find(m=>{const u=m.querySelector("img");return u&&u.id===a});if(c)if(o.has(c)&&(o.get(c).kill(),o.delete(c)),l){if(s=a,t&&t!==c){o.has(t)&&o.get(t).kill();const u=window.gsap.to(t,{opacity:0,duration:.15,ease:"power2.out",onComplete:()=>{t&&(t.style.display="none"),o.delete(t)}});o.set(t,u)}c.style.display="block";const m=window.gsap.to(c,{opacity:1,duration:.15,ease:"power2.out",onComplete:()=>o.delete(c)});o.set(c,m)}else{s===a&&(s=null);const m=window.gsap.to(c,{opacity:0,duration:.15,ease:"power2.out",onComplete:()=>{if(c.style.display="none",s===null&&t){t.style.display="block",o.has(t)&&o.get(t).kill();const u=window.gsap.to(t,{opacity:1,duration:.15,ease:"power2.out",onComplete:()=>o.delete(t)});o.set(t,u)}o.delete(c)}});o.set(c,m)}},r=(a,l)=>{o.has(a)&&(o.get(a).kill(),o.delete(a));const c={duration:l?.1:.05,ease:"power2.out",onComplete:()=>o.delete(a)},m=l?{scale:1.1,backgroundColor:"#FFFFFF"}:{scale:1,backgroundColor:""},u=window.gsap.to(a,{...m,...c});o.set(a,u)};e.forEach(a=>{const l=a.getAttribute("data-name");l&&(a.addEventListener("mouseenter",()=>{n(l,!0),r(a,!0)}),a.addEventListener("mouseleave",()=>{n(l,!1),r(a,!1)}))})};function he(){console.log("🔧 Configuration du gestionnaire de filtres vides v2.1.0..."),window.fsAttributes||(window.fsAttributes=[]),window.fsAttributes.push(["list",i=>{console.log("✅ Finsweet list callback déclenché!",i.length,"instances"),ye()}]),console.log("📋 Callback Finsweet configuré correctement avec fsAttributes")}function ye(){console.log("🎯 Configuration des filtres vides...");const i=document.querySelectorAll("input[fs-list-field]");console.log(`📊 ${i.length} inputs fs-list-field trouvés`),i.forEach((e,t)=>{if(e.closest(".is-list-emptyfacet")){console.log(`🔒 Input ${t+1} dans empty facet - désactivation`),e.style.cursor="default";const s=e.closest("label");s&&(s.style.cursor="default")}e.addEventListener("click",s=>{if(e.closest(".is-list-emptyfacet")){console.log("🚫 Clic bloqué sur filtre vide"),s.preventDefault(),s.stopPropagation();return}}),e.addEventListener("change",()=>{var r;if(e.closest(".is-list-emptyfacet"))return;const n=(r=e.closest(".tag_wrap"))==null?void 0:r.querySelector(".tags_content");n&&(e.checked?n.classList.add("is-active"):n.classList.remove("is-active"))})}),console.log("🎯 Filtres vides configurés avec succès")}class V{constructor(){this.version="1.2.1",this.initialized=!1,this.selectors={collectionList:'[fs-list-element="list"]',collectionItems:'[fs-list-element="item"]',filterInputs:"input[fs-list-field]",noItemsMessage:".w-dyn-empty",filterForms:'[fs-list-element="filters"]',cmsSlider:"#cms-slider-offres",helperText:"#helper-text"},this.messages={selectFilter:"👆 Sélectionnez un parc ou un type d'offre pour voir nos offres disponibles",noResults:"Aucune offre ne correspond à vos critères. Essayez une autre sélection."}}init(){const e=window.location.pathname;if(!["/offres","/anniversaires","/tarifs-generaux"].includes(e)){console.log(`🚫 mandatory-filter-selection.js - Page ${e} non concernée`);return}if(this.initialized){console.log("⚠️ mandatory-filter-selection.js déjà initialisé");return}console.log(`🎯 mandatory-filter-selection.js v${this.version} - Initialisation sur ${e}`),this.setupInitialState(),this.bindEvents(),this.initialized=!0,console.log("✅ Filtrage obligatoire activé - Sélectionnez un filtre pour voir les offres")}setupInitialState(){const e=document.querySelector(this.selectors.collectionList),t=document.querySelectorAll(this.selectors.collectionItems);if(!e){console.log("❌ Collection list non trouvée");return}t.forEach(o=>{o.style.display="none"}),this.showSelectionMessage(),this.hideCmsSlider(),this.showHelperText(),console.log(`🔒 ${t.length} offres cachées - En attente de sélection de filtre`)}showSelectionMessage(){const e=document.querySelector(this.selectors.collectionList);if(!e)return;const t=e.querySelector(".mandatory-filter-message");t&&t.remove();const o=document.createElement("div");if(o.className="mandatory-filter-message",o.style.cssText=`
            padding: 40px 20px;
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            margin: 20px 0;
            color: white;
            font-size: 18px;
            font-weight: 500;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
            animation: pulse 2s infinite;
        `,o.innerHTML=`
            <div style="font-size: 48px; margin-bottom: 16px;">🎯</div>
            <div>${this.messages.selectFilter}</div>
        `,!document.querySelector("#mandatory-filter-styles")){const s=document.createElement("style");s.id="mandatory-filter-styles",s.textContent=`
                @keyframes pulse {
                    0%, 100% { transform: scale(1); opacity: 1; }
                    50% { transform: scale(1.02); opacity: 0.9; }
                }
                .mandatory-filter-message {
                    transition: all 0.3s ease;
                }
            `,document.head.appendChild(s)}e.appendChild(o)}bindEvents(){const e=document.querySelectorAll(this.selectors.filterInputs);e.forEach(t=>{t.addEventListener("change",()=>{this.handleFilterChange()})}),window.addEventListener("list-updated",()=>{this.handleListUpdate()}),console.log(`🔗 ${e.length} filtres écoutés`)}handleFilterChange(){const e=document.querySelectorAll(`${this.selectors.filterInputs}:checked`);e.length>0?(console.log(`✅ ${e.length} filtre(s) sélectionné(s) - Affichage des offres`),this.showCollectionItems(),this.hideSelectionMessage(),this.showCmsSlider(),this.hideHelperText()):(console.log("🔒 Aucun filtre sélectionné - Masquage des offres"),this.hideCollectionItems(),this.showSelectionMessage(),this.hideCmsSlider(),this.showHelperText())}handleListUpdate(){const e=document.querySelectorAll(`${this.selectors.filterInputs}:checked`),t=document.querySelectorAll(`${this.selectors.collectionItems}:not([style*="display: none"])`);e.length>0&&t.length===0&&(console.log("⚠️ Aucun résultat pour les filtres sélectionnés"),this.showNoResultsMessage())}showCollectionItems(){document.querySelectorAll(this.selectors.collectionItems).forEach(t=>{t.style.display=""})}hideCollectionItems(){document.querySelectorAll(this.selectors.collectionItems).forEach(t=>{t.style.display="none"})}hideSelectionMessage(){const e=document.querySelector(".mandatory-filter-message");e&&(e.style.display="none")}showCmsSlider(){const e=document.querySelector(this.selectors.cmsSlider);e&&(e.style.display="",console.log("👁️ Slider CMS des offres affiché (filtre sélectionné)"))}hideCmsSlider(){const e=document.querySelector(this.selectors.cmsSlider);e&&(e.style.display="none",console.log("🙈 Slider CMS des offres masqué (aucun filtre)"))}showHelperText(){const e=document.querySelector(this.selectors.helperText);e&&(e.style.display="",console.log("👁️ Texte d'aide affiché (aucun filtre)"))}hideHelperText(){const e=document.querySelector(this.selectors.helperText);e&&(e.style.display="none",console.log("🙈 Texte d'aide masqué (filtre sélectionné)"))}showNoResultsMessage(){const e=document.querySelector(this.selectors.collectionList);if(!e||e.querySelector(".no-results-message"))return;const o=document.createElement("div");o.className="no-results-message",o.style.cssText=`
            padding: 30px 20px;
            text-align: center;
            background: #f8f9fa;
            border-radius: 8px;
            margin: 20px 0;
            color: #6c757d;
            font-size: 16px;
        `,o.innerHTML=`
            <div style="font-size: 32px; margin-bottom: 12px;">😕</div>
            <div>${this.messages.noResults}</div>
        `,e.appendChild(o),setTimeout(()=>{o.parentNode&&o.remove()},3e3)}reset(){this.hideSelectionMessage(),this.showCollectionItems(),this.hideCmsSlider(),this.showHelperText(),this.initialized=!1,console.log("🔄 Filtrage obligatoire réinitialisé")}}window.mandatoryFilterSelection=new V,document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{window.mandatoryFilterSelection.init()}):window.mandatoryFilterSelection.init(),console.log("🚀 mandatory-filter-selection.js v1.2.1 chargé");class G{constructor(){this.version="1.6.0",this.initialized=!1,this.selectors={formWrapper:"#devis-form-wrapper",filterElements:"[fs-list-value]",filterForms:'[fs-list-element="filters"]',mapElement:"#map"}}init(){const e=window.location.pathname;if(!["/smile-event"].includes(e)){console.log(`🚫 event-form-visibility.js - Page ${e} non concernée`);return}if(this.initialized){console.log("⚠️ event-form-visibility.js déjà initialisé");return}console.log(`🎯 event-form-visibility.js v${this.version} - Initialisation sur ${e}`),this.setupInitialState(),this.bindEvents(),this.setupMapData(),this.initialized=!0,console.log("✅ Logique d'affichage du formulaire de devis activée")}setupInitialState(){const e=document.querySelector(this.selectors.formWrapper);if(!e){console.log("❌ Conteneur du formulaire de devis non trouvé");return}e.style.display="none",console.log("🔒 Formulaire de devis caché - En attente de sélection de centre")}setupMapData(){if(!document.querySelector(this.selectors.mapElement)){console.log("ℹ️ Aucun élément #map trouvé, pas d'initialisation de carte");return}const t=document.querySelector("select[fs-list-field]");if(!t){console.log("❌ Dropdown des centres non trouvé pour récupérer les données de la carte");return}const o=document.createElement("div");o.id="centres-data-container",o.style.display="none",document.body.appendChild(o);let s=0;Array.from(t.options).forEach((n,r)=>{if(r===0||!n.value)return;const a=n.dataset.placeId,l=n.dataset.lat,c=n.dataset.lng,m=n.textContent.trim();if(a&&l&&c){const u=document.createElement("div");u.className="w-dyn-item",u.setAttribute("data-place-id",a),u.setAttribute("data-lat",l),u.setAttribute("data-lng",c);const S=document.createElement("h3");S.textContent=m,u.appendChild(S),o.appendChild(u),s++}else console.warn(`⚠️ Données manquantes pour le centre "${m}". Vérifiez les attributs data-place-id, data-lat, data-lng sur l'option du dropdown.`)}),s>0?(console.log(`🗺️ ${s} centres configurés pour la carte Google Maps`),window.mapManager&&window.mapManager.createMarkers()):console.log("⚠️ Aucune donnée de centre trouvée pour la carte. Ajoutez les attributs data-place-id, data-lat, data-lng aux options du dropdown côté Webflow.")}bindEvents(){const e=document.querySelectorAll(this.selectors.filterElements);e.forEach(t=>{t.addEventListener("change",()=>{this.handleFilterChange()}),t.addEventListener("click",()=>{this.handleFilterChange()})}),window.addEventListener("list-updated",()=>{this.handleFilterChange()}),console.log(`🔗 ${e.length} élément(s) de filtre écouté(s)`)}handleFilterChange(){const e=document.querySelectorAll(this.selectors.filterElements);let t=!1;e.forEach(o=>{if(o.checked||o.classList.contains("w--current")||o.tagName.toLowerCase()==="select"&&o.value&&o.value!==""){const s=o.getAttribute("fs-list-value");s&&(t=!0,console.log(`🎯 Filtre actif détecté: ${s}`))}}),t?(console.log("✅ Centre sélectionné - Affichage du formulaire de devis"),this.showFormWrapper()):(console.log("🔒 Aucun centre sélectionné - Masquage du formulaire de devis"),this.hideFormWrapper())}showFormWrapper(){const e=document.querySelector(this.selectors.formWrapper);e&&(e.style.display="")}hideFormWrapper(){const e=document.querySelector(this.selectors.formWrapper);e&&(e.style.display="none")}reset(){this.hideFormWrapper();const e=document.getElementById("centres-data-container");e&&e.remove(),this.initialized=!1,console.log("🔄 Logique du formulaire de devis réinitialisée")}}window.eventFormVisibility=new G,document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{window.eventFormVisibility.init()}):window.eventFormVisibility.init(),console.log("🚀 event-form-visibility.js v1.6.0 chargé"),console.log("🎠 marquee-animation.js v2.1.0 chargé");let C=null,$=new WeakMap;function ve(){console.log("🎬 Initialisation de l'animation marquee draggable...");const i=document.querySelectorAll(".cms_slider_wrapper");if(i.length===0){console.log("-> Aucun élément .cms_slider_wrapper trouvé. Animation marquee ignorée.");return}i.forEach((e,t)=>{we(e,t)})}function we(i,e){const t=gsap.utils.toArray(i.children);if(t.length===0){console.warn(`-> Wrapper ${e}: Aucun slide trouvé.`);return}gsap.set(t,{x:s=>s*t[s].offsetWidth});const o=_e(t,{paused:!0,draggable:!0,center:!1,speed:.5,reversed:!1});Se(t,o),console.log(`✅ Marquee draggable ${e} initialisé avec effets de survol.`)}function Se(i,e){i.forEach((t,o)=>{const s=t.querySelector(".vimeo.activity"),n=t.querySelector("#titre-original");s&&gsap.set(s,{display:"none",opacity:0}),n&&!n.dataset.originalColor&&(n.dataset.originalColor=window.getComputedStyle(n).color),$.set(t,{isHovered:!1,elements:{vimeo:s,titre:n}}),t.addEventListener("mouseenter",()=>be(t,e)),t.addEventListener("mouseleave",()=>ke(t,e))})}function be(i,e){const t=$.get(i);if(t.isHovered)return;t.isHovered=!0,C&&C!==i&&U(C,e),C=i,e.draggable&&e.draggable.disable();const{vimeo:o,titre:s}=t.elements;if(o&&(gsap.killTweensOf(o),gsap.set(o,{display:"flex"}),gsap.to(o,{opacity:1,duration:.3,ease:"power2.out"}),s)){gsap.killTweensOf(s);const n=s.dataset.originalColor||"#000000",r=Ae(n)?"#000000":"#ffffff";gsap.to(s,{color:r,duration:.3,ease:"power2.out"})}}function ke(i,e){const t=$.get(i);t.isHovered&&(t.isHovered=!1,setTimeout(()=>{!i.matches(":hover")&&C===i&&(U(i,e),C=null)},50))}function U(i,e){const t=$.get(i);if(!t)return;e.draggable&&e.draggable.enable();const{vimeo:o,titre:s}=t.elements;if(o&&(gsap.killTweensOf(o),gsap.to(o,{opacity:0,duration:.2,ease:"power2.out",onComplete:()=>gsap.set(o,{display:"none"})}),s)){gsap.killTweensOf(s);const n=s.dataset.originalColor||"#000000";gsap.to(s,{color:n,duration:.2,ease:"power2.out"})}t.isHovered=!1}function Ae(i){let e,t,o;if(i.startsWith("#")){const n=i.substring(1);e=parseInt(n.substring(0,2),16),t=parseInt(n.substring(2,4),16),o=parseInt(n.substring(4,6),16)}else if(i.startsWith("rgb"))[e,t,o]=i.match(/\d+/g).map(Number);else return!1;return(.299*e+.587*t+.114*o)/255>.5}function _e(i,e){i=gsap.utils.toArray(i),e=e||{};let t=gsap.timeline({repeat:-1,paused:e.paused,defaults:{ease:"none"},onReverseComplete:()=>t.totalTime(t.rawTime()+t.duration()*100)}),o=i.length,s=i[0].x,n=[],r=[],a=[],l=0,c=(e.speed||1)*100,m=e.snap===!1?p=>p:gsap.utils.snap(e.snap||1),u=()=>i.forEach((p,f)=>{r[f]=parseFloat(gsap.getProperty(p,"width","px")),a[f]=m(parseFloat(gsap.getProperty(p,"x","px"))/r[f]*100+gsap.getProperty(p,"xPercent"))}),S=()=>i[o-1].x+a[o-1]/100*r[o-1]-s+i[o-1].offsetWidth*gsap.getProperty(i[o-1],"scaleX"),b,y,_,k,x,g;for(u(),gsap.set(i,{xPercent:p=>a[p]}),gsap.set(i,{x:0}),b=S(),g=0;g<o;g++)x=i[g],y=a[g]/100*r[g],_=x.x-y,k=_+b*(y>0?-1:1),t.to(x,{xPercent:m((y-k)/r[g]*100),duration:k/c},0).fromTo(x,{xPercent:m((y-k+b)/r[g]*100)},{xPercent:a[g],duration:(y-k+b-y)/c,immediateRender:!1},k/c).add("label"+g,_/c),n[g]=_/c;function A(p,f){f=f||{},Math.abs(p-l)>o/2&&(p+=p>l?-o:o);let E=gsap.utils.wrap(0,o,p),w=n[E];return w>t.time()!=p>l&&(f.modifiers={time:gsap.utils.wrap(0,t.duration())},w+=t.duration()*(p>l?1:-1)),l=E,f.overwrite=!0,t.tweenTo(w,f)}if(t.next=p=>A(l+1,p),t.previous=p=>A(l-1,p),t.current=()=>l,t.toIndex=(p,f)=>A(p,f),t.updateIndex=()=>l=Math.round(t.progress()*i.length),t.times=n,t.progress(1,!0).progress(0,!0),e.reversed&&(t.vars.onReverseComplete(),t.reverse()),e.draggable&&typeof Draggable=="function"){let p=document.createElement("div"),f=gsap.utils.wrap(0,1),E,w,d,I=()=>{let Pe=f(w+(d.startX-d.x)*E);t.progress(Pe)},v=()=>t.closestIndex(!0);typeof InertiaPlugin>"u"&&console.warn("InertiaPlugin required for momentum-based scrolling and snapping. https://greensock.com/inertia/"),d=Draggable.create(p,{trigger:i[0].parentNode,type:"x",onPressInit(){gsap.killTweensOf(t),w=t.progress(),E=1/S()},onDrag:I,onThrowUpdate:I,inertia:!0,onRelease(){v()},onThrowComplete:v})[0],t.draggable=d}return t}console.log("🚀 main_gsap.js v3.0.3 chargé");function xe(){console.log("✅ GSAP est prêt. Initialisation des modules..."),window.Draggable&&window.InertiaPlugin?(window.gsap.registerPlugin(window.Draggable,window.InertiaPlugin),console.log("✅ Plugins Draggable et Inertia enregistrés.")):console.error("❌ Draggable ou InertiaPlugin non trouvés sur window. Assurez-vous qu'ils sont chargés.");try{Y(),ie(),oe(),de(),ge(),he(),new G().init(),window.location.pathname.includes("/reservation")&&(console.log("-> Page Réservation détectée via l'URL. Chargement du module..."),pe(),console.log("✅ Module Réservation chargé et initialisé."));const i=window.location.pathname;(i==="/offres"||i==="/anniversaires")&&(console.log(`-> Page ${i} détectée. Initialisation du filtrage obligatoire...`),new V().init(),console.log("✅ Module de filtrage obligatoire chargé et initialisé.")),(i==="/"||i==="/index"||i==="")&&(console.log("-> Page d'accueil détectée. Initialisation de l'animation marquee..."),setTimeout(()=>{ve()},500)),me(),document.querySelector('[data-attribute="preselect-booking-button"]')&&(console.log("-> Bouton de présélection détecté. Initialisation du module."),fe()),console.log("✨ Tous les modules principaux ont été initialisés."),K()}catch(i){console.error("❌ Erreur lors de l'initialisation des modules. Forçage du masquage du loader.",i),z()}}function Ee(){Z();let i=0;const e=100,o=setInterval(()=>{window.gsap?(clearInterval(o),xe()):(i++,i>e&&(clearInterval(o),console.error("GSAP n'a pas pu être chargé après 10 secondes. Annulation de l'initialisation des modules."),z()))},100)}window.Webflow=window.Webflow||[],window.Webflow.push(function(){console.log("🚀 Webflow est prêt, lancement de l'attente de GSAP."),Ee()}),window.addEventListener("load",()=>{console.log("🎬 La page est entièrement chargée. Initialisation des modules dépendants du contenu."),le(),ee()})})();
